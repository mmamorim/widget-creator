var e=require("chalk"),o=require("chokidar"),n=require("app-root-path"),t=require("fs"),i=require("firebase/app"),r=require("firebase/database"),l=require("crypto-js"),s=require("vue-sfc-parser");function d(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a,c,u,f=/*#__PURE__*/d(e),g=/*#__PURE__*/d(o),p=/*#__PURE__*/d(n),v=/*#__PURE__*/d(l),m=(a=v.default.enc.Utf8.parse("hf8685nfhfhjs9h8"),c=v.default.enc.Utf8.parse("hf8685nfhfhjs9h8"),u=v.default.AES.decrypt("nQcXOmRHFeJxZtK8z0vg6mw+56NosLs/8I9POQWFEBs5ZJzqraJEe+9S6xaW8eHpNubzsmX+5qvFciisOtgvu57msPSmcPy3wnRYPzRbKDen30JgAaY6uzufSp+tZBeeMEDLVBJwPu/vSLd7qJdw3ofJ4uiIACAPiuKcg5k//ox3n1elzqwdMpBgsLkIhvo8YFnGWVGHr52t8inxEY28w6JV6RLOe95+6lwQoy94998FQNKyHg08GHCxaDXLb2gPwpgIHj8fS/SJAjxE8UTPBS8r+4IL3RH3HseQLHW4pkFW0aCtlwjPtKsziGIMTFcjQhIVxw648OC7MCaXTfuvUszpdboCWEH6SYCa1xgluKzgASnhDZJbU65mV0sqnGh8NFRxcrzU6eCGNKIyfS61b+6vfJD1NnsBhHXnwiCHewqavymbBWyl3Wt31UptpM4kVH7WLoZohbH509x5KMqJtg==",a,{keySize:16,iv:c,mode:v.default.mode.ECB,padding:v.default.pad.Pkcs7}),JSON.parse(u.toString(v.default.enc.Utf8))),h=i.initializeApp(m,"users-rtdb"),w=r.getDatabase(h),b=function(e){return r.ref(w,"/dev/"+e)},_=function(e){try{return Promise.resolve(r.get(b(e))).then(function(e){return e.val()})}catch(e){return Promise.reject(e)}},P=function(e,o){try{return Promise.resolve(r.set(b(e),o)).then(function(){})}catch(e){return Promise.reject(e)}},W={cfg_widgets:"",path:p.default.path+"/",user_dev:{},init:function(e){W.cfg_widgets=e.widgets_folder,W.path=W.path+W.cfg_widgets,W.user_dev=e.user_dev,g.default.watch(W.path,{persistent:!0}).on("change",function(e,o){var n=e.split("/"+W.cfg_widgets+"/");W.fileChange(e,n[1],o.size)}),console.log("📡 "+f.default.green.bold("escutando por widgets na pasta ")+W.cfg_widgets)},read:function(e){try{try{var o=t.readFileSync(e,{encoding:"utf8"});return Promise.resolve(o)}catch(o){"ENOENT"==o.code?console.log("["+e+"] não encontrado!"):console.log("["+e+"] ERRO desconhecido!")}return Promise.resolve()}catch(e){return Promise.reject(e)}},fileChange:function(e,o,n){try{return console.log("👀 "+f.default.blue.bold("Opa! percebi algo...")),console.log("👀 "+f.default.green.bold("["+o+"] alterado...")),Promise.resolve(W.read(e)).then(function(e){var o,n=(o={widget:null,userdev:W.user_dev,parse:function(e){try{return Promise.resolve(function(e,o){try{var n={widget_info:{},widget_last:{},template:"",script:"",userdev:o,parseOk:!1,pathWG:"widgets/",pathWGUser:"users_devs/",pathWGBkp:"widgets_backup/",parse:function(e){var o=s.parseComponent(e);if(null!=o.template){var t=o.template.content.trim();if(null!=o.script){var i=o.script.content.split("export default")[1].trim();try{var r=new Function("widget,wg","return "+i)(),l=n.getWidgetInfo(r);if(null==l)return void console.log("🙁 "+f.default.red.bold("não foi possível a publicação..."));n.widget_info=l,n.template=t,n.script=i,n.parseOk=!0}catch(e){console.log("🙁 "+f.default.red.bold("Ohh não! script com erro...")),console.log(f.default.blue(e.name)+": "+f.default.red(e.message))}}else console.log("🙁 "+f.default.red.bold("erro ao interpretar script..."))}else console.log("🙁 "+f.default.red.bold("erro ao interpretar template..."))},getWidgetInfo:function(e){var o=e.widget;return null==o?(console.log("🙁 "+f.default.red.bold("informações do widget não encontradas...")),console.log("🤔 "+f.default.blue("você adicionou o atributo [widget] no component?")),null):null==o.name?(console.log("🙁 "+f.default.red.bold("nome do widget não encontrado...")),console.log("🤔 "+f.default.blue("você adicionou o atributo [name] p/ o widget?")),null):null==o.id?(console.log("🙁 "+f.default.red.bold("id do widget não encontrado...")),console.log("🤔 "+f.default.blue("você adicionou o atributo [id] p/ o widget?")),null):null==o.namespace?(console.log("🙁 "+f.default.red.bold("namespace do widget não encontrado...")),console.log("🤔 "+f.default.blue("você adicionou o atributo [namespace] p/ o widget?")),null):null==o.commit?(console.log("🙁 "+f.default.red.bold("commit do widget não encontrado...")),console.log("🤔 "+f.default.blue("você adicionou o atributo [commit] p/ o widget?")),null):(console.log("👀 widget "+f.default.green.bold("["+o.id+"] ["+o.name+"] encontrado...")),o)},checkFirstVersion:function(){try{return Promise.resolve(_(n.pathWG)).then(function(e){null==e?(console.log("👀 widget "+n.infoLog()+" PRIMEIRA VERSÃO"),n.widget_info.devs={},n.widget_info.devs[n.userdev.id]=n.userdev):(console.log("👀 widget "+n.infoLog()+" "+e.version+" ENCONTRADA"),n.widget_info.devs=e.devs,n.widget_info.devs[n.userdev.id]=n.userdev,n.widget_last=e)})}catch(e){return Promise.reject(e)}},infoLog:function(){var e=n.widget_info;return f.default.green.bold("[🏷️ NS:"+e.namespace+"] [🪪 ID:"+e.id+"] [NAME:"+e.name+"]")}};n.parse(e);var t=function(){if(n.parseOk)return n.pathWG=n.pathWG+n.widget_info.namespace+"/"+n.widget_info.id,n.pathWGUser=n.pathWGUser+n.userdev.id+"/"+n.widget_info.id,n.pathWGBkp=n.pathWGBkp+n.widget_info.namespace+"/"+n.widget_info.id+"/"+n.widget_info.version,Promise.resolve(n.checkFirstVersion()).then(function(){});n.pathWG=n.pathWG+"no-id",n.pathWGUser=n.pathWGUser+"no-id",n.pathWGBkp=n.pathWGBkp+"no-id"}();return Promise.resolve(t&&t.then?t.then(function(){return n}):n)}catch(e){return Promise.reject(e)}}(e,o.userdev)).then(function(e){o.widget=e})}catch(e){return Promise.reject(e)}},publish_widget:function(){try{return Promise.resolve(o.checkNewVersion()).then(function(){null==o.widget.widget_info.prod&&(o.widget.widget_info.prod=!1);var e=o.widget.widget_info;return e.template=o.widget.template,e.script=o.widget.script,Promise.resolve(P(o.widget.pathWG,e)).then(function(){return console.log("🚀 widget "+o.widget.infoLog()+" versão "+e.version+" PUBLICADA!"),Promise.resolve(P(o.widget.pathWGUser,e.namespace+"/"+e.id)).then(function(){})})})}catch(e){return Promise.reject(e)}},checkNewVersion:function(){try{var e=o.widget.widget_info,n=o.widget.widget_last,t=function(){if(null!=n.commit&&n.commit!=e.commit)return console.log("🔥 novo commit "+f.default.green.bold("["+n.id+"] ["+n.name+"] "+e.commit)),Promise.resolve(P(o.widget.pathWGBkp,n)).then(function(){console.log("🗃️  widget antigo "+f.default.green.bold("["+n.id+"] ["+n.name+"] backup versão "+n.version+" armazenado")),n.version++})}();return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}},o);return Promise.resolve(n.parse(e)).then(function(){var e=function(){if(n.widget.parseOk)return console.log("parse ok"),Promise.resolve(n.publish_widget()).then(function(){console.log("📡 "+f.default.green.bold("escutando por widgets na pasta ")+W.cfg_widgets)})}();if(e&&e.then)return e.then(function(){})})})}catch(e){return Promise.reject(e)}}},y={prefix:"",user_dev:"",set_config:!1,config:void 0,setPrefix:function(e){y.prefix=e},missingField:function(e,o,n){return null!=e||(console.log("🙁 "+f.default.red.bold("informações não encontradas...")),console.log("🤔 "+f.default.blue("você adicionou o atributo ["+o+"] no "+n+" ?")),!1)},setConfig:function(e){y.set_config=!0,y.missingField(e.user_dev,"user_dev","config.json")&&y.missingField(e.user_dev.id,"user_dev.id","config.json")&&y.missingField(e.user_dev.name,"user_dev.name","config.json")&&(y.config=e,y.user_dev=e.user_dev)},splash:function(){console.log("🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱"),console.log("  🟥🔷 "+y.prefix+" widget"),console.log("  {}🟪 CREATOR (v 1.0)"),console.log("🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱"),console.log(f.default.yellow.bold("👨‍💻 Olá "+y.user_dev.name+"!"))},init:function(){if(!y.set_config)return console.log("🙁 "+f.default.red.bold("config não inicializado...")),void console.log("🤔 "+f.default.blue("você chamou setConfig() ?"));y.splash(),W.init(y.config)}},k={prefix:"",user_dev:"",set_config:!1,config:void 0,setPrefix:function(e){k.prefix=e},missingField:function(e,o,n){return null!=e||(console.log("🙁 "+f.default.red.bold("informações não encontradas...")),console.log("🤔 "+f.default.blue("você adicionou o atributo ["+o+"] no "+n+" ?")),!1)},setConfig:function(e){k.set_config=!0,k.missingField(e.user_dev,"user_dev","config.json")&&k.missingField(e.user_dev.id,"user_dev.id","config.json")&&k.missingField(e.user_dev.name,"user_dev.name","config.json")&&(k.config=e,k.user_dev=e.user_dev)},splash:function(){console.log("〰️〰️〰️〰️〰️〰️〰️〰️〰️〰️〰️"),console.log("  🟥🔷 "+k.prefix+" widget"),console.log("  {}🟪 CLONE (v 1.0)"),console.log("〰️〰️〰️〰️〰️〰️〰️〰️〰️〰️〰️"),console.log(f.default.yellow.bold("👨‍💻 Olá "+k.user_dev.name+"!"))},init:function(e,o){try{if(!k.set_config)return console.log("🙁 "+f.default.red.bold("config não inicializado...")),console.log("🤔 "+f.default.blue("você chamou setConfig() ?")),Promise.resolve();k.splash();var n=f.default.green.bold("[🏷️ NS:"+e+"] [🪪 ID:"+o+"]");return console.log("👀 procurando widget "+n),Promise.resolve(_("widgets/"+e+"/"+o)).then(function(e){var o=function(){if(null!=e){console.log("👍 "+f.default.green.bold("achei")),console.log("💫 "+f.default.blue("clonando em na pasta ")+k.config.widgets_folder);var o="<template>\n\t"+e.template+"\n</template>";return o=o+"\n<script>\nexport default "+e.script+"\n<\/script>",Promise.resolve(t.writeFileSync(k.config.widgets_folder+"/"+e.id+".vue",o)).then(function(){console.log("💫 "+f.default.blue("arquivo ")+e.id+".vue"+f.default.green.bold(" salvo com sucesso!"))})}console.log("🙁 "+f.default.red.bold("não encontrado..."))}();if(o&&o.then)return o.then(function(){})})}catch(e){return Promise.reject(e)}}};exports.clone=k,exports.creator=y;
//# sourceMappingURL=widget-creator.cjs.map
