!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?o(exports,require("chalk"),require("chokidar"),require("app-root-path"),require("fs"),require("firebase/app"),require("firebase/database"),require("crypto-js"),require("vue-sfc-parser"),require("sharp")):"function"==typeof define&&define.amd?define(["exports","chalk","chokidar","app-root-path","fs","firebase/app","firebase/database","crypto-js","vue-sfc-parser","sharp"],o):o((e||self).widgetCreator={},e.chalk,e.chokidar,e.appRootPath,e.fs,e.app$1,e.database,e.cryptoJs,e.vueSfcParser,e.sharp)}(this,function(e,o,t,n,r,i,d,a,s,l){function c(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var g,u,f,m=/*#__PURE__*/c(o),p=/*#__PURE__*/c(t),v=/*#__PURE__*/c(n),h=/*#__PURE__*/c(a),b=/*#__PURE__*/c(l),w=(g=h.default.enc.Utf8.parse("hf8685nfhfhjs9h8"),u=h.default.enc.Utf8.parse("hf8685nfhfhjs9h8"),f=h.default.AES.decrypt("nQcXOmRHFeJxZtK8z0vg6mw+56NosLs/8I9POQWFEBs5ZJzqraJEe+9S6xaW8eHpNubzsmX+5qvFciisOtgvu57msPSmcPy3wnRYPzRbKDen30JgAaY6uzufSp+tZBeeMEDLVBJwPu/vSLd7qJdw3ofJ4uiIACAPiuKcg5k//ox3n1elzqwdMpBgsLkIhvo8YFnGWVGHr52t8inxEY28w6JV6RLOe95+6lwQoy94998FQNKyHg08GHCxaDXLb2gPwpgIHj8fS/SJAjxE8UTPBS8r+4IL3RH3HseQLHW4pkFW0aCtlwjPtKsziGIMTFcjQhIVxw648OC7MCaXTfuvUszpdboCWEH6SYCa1xgluKzgASnhDZJbU65mV0sqnGh8NFRxcrzU6eCGNKIyfS61b+6vfJD1NnsBhHXnwiCHewqavymbBWyl3Wt31UptpM4kVH7WLoZohbH509x5KMqJtg==",g,{keySize:16,iv:u,mode:h.default.mode.ECB,padding:h.default.pad.Pkcs7}),JSON.parse(f.toString(h.default.enc.Utf8))),_=i.initializeApp(w,"users-rtdb"),P=d.getDatabase(_),y=function(e){return d.ref(P,"/dev/"+e)},O=function(e){try{return Promise.resolve(d.get(y(e))).then(function(e){return e.val()})}catch(e){return Promise.reject(e)}},S=function(e,o){try{return Promise.resolve(d.set(y(e),o)).then(function(){})}catch(e){return Promise.reject(e)}},k={cfg_widgets:"",path:v.default.path+"/",user_dev:{},init:function(e){k.cfg_widgets=e.widgets_folder,k.path=k.path+k.cfg_widgets,k.user_dev=e.user_dev,p.default.watch(k.path,{persistent:!0}).on("change",function(e,o){var t=e.split("/"+k.cfg_widgets+"/");k.fileChange(e,t[1],o.size)}),console.log("📡 "+m.default.green.bold("escutando por widgets na pasta ")+k.cfg_widgets)},read:function(e){try{try{var o=r.readFileSync(e,{encoding:"utf8"});return Promise.resolve(o)}catch(o){"ENOENT"==o.code?console.log("["+e+"] não encontrado!"):console.log("["+e+"] ERRO desconhecido!")}return Promise.resolve()}catch(e){return Promise.reject(e)}},fileChange:function(e,o,t){try{return console.log("👀 "+m.default.blue.bold("Opa! percebi algo...")),console.log("👀 "+m.default.green.bold("["+o+"] alterado...")),Promise.resolve(k.read(e)).then(function(e){var o=function(e){var o={widget:null,userdev:e,parse:function(e){try{return Promise.resolve(function(e,o){try{var t={widget_info:{},widget_last:{},template:"",script:"",userdev:o,parseOk:!1,pathWG:"widgets/",pathWGUser:"users_devs/",pathWGBkp:"widgets_backup/",parse:function(e){var o=s.parseComponent(e);if(null!=o.template){var n=o.template.content.trim();if(null!=o.script){var r=o.script.content.split("export default")[1].trim();try{var i=new Function("widget,wg","return "+r)(),d=t.getWidgetInfo(i);if(null==d)return void console.log("🙁 "+m.default.red.bold("não foi possível a publicação..."));t.widget_info=d,t.template=n,t.script=r,t.parseOk=!0}catch(e){console.log("🙁 "+m.default.red.bold("Ohh não! script com erro...")),console.log(m.default.blue(e.name)+": "+m.default.red(e.message))}}else console.log("🙁 "+m.default.red.bold("erro ao interpretar script..."))}else console.log("🙁 "+m.default.red.bold("erro ao interpretar template..."))},getWidgetInfo:function(e){var o=e.widget;return null==o?(console.log("🙁 "+m.default.red.bold("informações do widget não encontradas...")),console.log("🤔 "+m.default.blue("você adicionou o atributo [widget] no component?")),null):null==o.name?(console.log("🙁 "+m.default.red.bold("nome do widget não encontrado...")),console.log("🤔 "+m.default.blue("você adicionou o atributo [name] p/ o widget?")),null):null==o.id?(console.log("🙁 "+m.default.red.bold("id do widget não encontrado...")),console.log("🤔 "+m.default.blue("você adicionou o atributo [id] p/ o widget?")),null):null==o.namespace?(console.log("🙁 "+m.default.red.bold("namespace do widget não encontrado...")),console.log("🤔 "+m.default.blue("você adicionou o atributo [namespace] p/ o widget?")),null):null==o.commit?(console.log("🙁 "+m.default.red.bold("commit do widget não encontrado...")),console.log("🤔 "+m.default.blue("você adicionou o atributo [commit] p/ o widget?")),null):(console.log("👀 widget "+m.default.green.bold("["+o.id+"] ["+o.name+"] encontrado...")),o)},checkFirstVersion:function(){try{return Promise.resolve(O(t.pathWG)).then(function(e){null==e?(console.log("👀 widget "+t.infoLog()+" PRIMEIRA VERSÃO"),t.widget_info.devs={},t.widget_info.devs[t.userdev.id]=t.userdev):(console.log("👀 widget "+t.infoLog()+" "+e.version+" ENCONTRADA"),t.widget_info.devs=e.devs,t.widget_info.devs[t.userdev.id]=t.userdev,t.widget_last=e)})}catch(e){return Promise.reject(e)}},infoLog:function(){var e=t.widget_info;return m.default.green.bold("[🏷️ NS:"+e.namespace+"] [🪪 ID:"+e.id+"] [NAME:"+e.name+"]")}};t.parse(e);var n=function(){if(t.parseOk)return t.pathWG=t.pathWG+t.widget_info.namespace+"/"+t.widget_info.id,t.pathWGUser=t.pathWGUser+t.userdev.id+"/widgets",t.pathWGBkp=t.pathWGBkp+t.widget_info.namespace+"/"+t.widget_info.id+"/"+t.widget_info.version,Promise.resolve(t.checkFirstVersion()).then(function(){});t.pathWG=t.pathWG+"no-id",t.pathWGUser=t.pathWGUser+"no-id",t.pathWGBkp=t.pathWGBkp+"no-id"}();return Promise.resolve(n&&n.then?n.then(function(){return t}):t)}catch(e){return Promise.reject(e)}}(e,o.userdev)).then(function(e){o.widget=e})}catch(e){return Promise.reject(e)}},publish_widget:function(){try{return Promise.resolve(o.checkNewVersion()).then(function(){null==o.widget.widget_info.prod&&(o.widget.widget_info.prod=!1);var e=o.widget.widget_info;return e.template=o.widget.template,e.script=o.widget.script,Promise.resolve(S(o.widget.pathWG,e)).then(function(){return console.log("🚀 widget "+o.widget.infoLog()+" versão "+e.version+" PUBLICADA!"),Promise.resolve(S(o.widget.pathWGUser+"/"+e.namespace+"/"+e.id,e.namespace+"/"+e.id)).then(function(){})})})}catch(e){return Promise.reject(e)}},checkNewVersion:function(){try{var e=o.widget.widget_info,t=o.widget.widget_last,n=function(){if(null!=t.commit&&t.commit!=e.commit)return console.log("🔥 novo commit "+m.default.green.bold("["+t.id+"] ["+t.name+"] "+e.commit)),Promise.resolve(S(o.widget.pathWGBkp,t)).then(function(){console.log("🗃️  widget antigo "+m.default.green.bold("["+t.id+"] ["+t.name+"] backup versão "+t.version+" armazenado")),t.version++})}();return Promise.resolve(n&&n.then?n.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}};return o}(k.user_dev);return Promise.resolve(o.parse(e)).then(function(){var e=function(){if(o.widget.parseOk)return Promise.resolve(o.publish_widget()).then(function(){console.log("📡 "+m.default.green.bold("escutando por widgets na pasta ")+k.cfg_widgets)})}();if(e&&e.then)return e.then(function(){})})})}catch(e){return Promise.reject(e)}}},j={cfg_gadgets:"",path:v.default.path+"/",user_dev:{},init:function(e){j.cfg_gadgets=e.gadgets_folder,j.path=j.path+j.cfg_gadgets,j.user_dev=e.user_dev,p.default.watch(j.path,{persistent:!0}).on("change",function(e,o){var t=e.split("/"+j.cfg_gadgets+"/");j.fileChange(e,t[1],o.size)}),console.log("📡 "+m.default.green.bold("escutando por GADGETS na pasta ")+j.cfg_gadgets)},read:function(e){try{try{var o=r.readFileSync(e,{encoding:"utf8"});return Promise.resolve(o)}catch(o){"ENOENT"==o.code?console.log("["+e+"] não encontrado!"):console.log("["+e+"] ERRO desconhecido!")}return Promise.resolve()}catch(e){return Promise.reject(e)}},fileChange:function(e,o,t){try{console.log("👀 "+m.default.blue.bold("Opa! percebi algo...")),console.log("👀 "+m.default.green.bold("["+o+"] alterado..."));var n="",r="",i=e.lastIndexOf(".");return".json"==e.substr(i)?(n=e,r=e.substr(0,i)+".md"):(n=e.substr(0,i)+".json",r=e),Promise.resolve(j.read(n)).then(function(o){return Promise.resolve(j.read(r)).then(function(t){var n=function(e){var o={gadget:null,userdev:e,parse:function(e,t){try{var n=JSON.parse(e);return o.checkDataJSON(n)?(o.gadget=n,o.gadget.readme=t,o.gadget.parseOk=!0,Promise.resolve()):(o.gadget={parseOk:!1},Promise.resolve(!1))}catch(e){return Promise.reject(e)}},publish_gadget:function(){try{return Promise.resolve(o.checkNewVersion()).then(function(){return null==o.gadget.prod&&(o.gadget.prod=!1),Promise.resolve(S("gadgets/"+o.gadget.category+"/"+o.gadget.id,o.gadget)).then(function(){return Promise.resolve(S("users_devs/"+o.userdev.id+"/gadgets/"+o.gadget.category+"/"+o.gadget.id,o.gadget.category+"|"+o.gadget.id)).then(function(){console.log("🚀 novo gadget "+m.default.green.bold("["+o.gadget.category+"] ["+o.gadget.id+"] versão "+o.gadget.version+" PUBLICADO!"))})})})}catch(e){return Promise.reject(e)}},checkNewVersion:function(){try{return Promise.resolve(O("gadgets/"+o.gadget.category+"/"+o.gadget.id)).then(function(e){if(null==e)return console.log("👀 gadget "+m.default.green.bold("["+o.gadget.category+"] ["+o.gadget.id+"] "+o.gadget.commit)+" PRIMEIRA VERSÃO"),void(o.gadget.version=1);o.gadget.version=e.version;var t=function(){if(e.commit!=o.gadget.commit)return console.log("🔥 novo commit "+m.default.green.bold("["+o.gadget.category+"] ["+o.gadget.id+"] "+o.gadget.commit)),Promise.resolve(S("gadgets_backup/"+o.gadget.category+"/"+o.gadget.id+"/"+o.gadget.version,e)).then(function(){console.log("🗃️  gadget antigo "+m.default.green.bold("["+e.category+"] ["+e.id+"] backup versão "+e.version+" armazenado")),null==o.gadget.version?o.gadget.version=1:o.gadget.version++})}();return t&&t.then?t.then(function(){}):void 0})}catch(e){return Promise.reject(e)}},missingField:function(e,o,t){return null!=e||(console.log("🙁 "+m.default.red.bold("informações não encontradas...")),console.log("🤔 "+m.default.blue("você adicionou o atributo ["+o+"] no "+t+" ?")),!1)},checkDataJSON:function(e){return!(!o.missingField(e.id,"id","JSON do gadget")||!o.missingField(e.category,"category","JSON do gadget")||!o.missingField(e.name,"name","JSON do gadget")||!o.missingField(e.commit,"commit","JSON do gadget")||!o.missingField(e.author,"author","JSON do gadget")||!o.missingField(e.description,"description","JSON do gadget")||!o.missingField(e.homepage,"homepage","JSON do gadget")||!o.missingField(e.icon,"icon","JSON do gadget")||!o.missingField(e.main_widget,"main_widget","JSON do gadget")||!o.missingField(e.main_widget_namespace,"main_widget_namespace","JSON do gadget")||(console.log("👀 gadget "+m.default.green.bold("["+e.id+"] ["+e.name+"] ok")),0))}};return o}(j.user_dev);return Promise.resolve(n.parse(o,t)).then(function(){var o=function(){if(n.gadget.parseOk)return Promise.resolve(j.loadIcon(n.gadget,e)).then(function(e){return e?n.gadget.icon=e:console.log("🙁 "+m.default.red.bold("GADGET com problemas...")),Promise.resolve(n.publish_gadget()).then(function(){console.log("📡 "+m.default.green.bold("escutando por GADGETS na pasta ")+j.cfg_gadgets)})});console.log("🙁 "+m.default.red.bold("GADGET parse error..."))}();if(o&&o.then)return o.then(function(){})})})})}catch(e){return Promise.reject(e)}},loadIcon:function(e,o){try{var t,n=function(o){return t?o:e.icon},i=o.lastIndexOf("/"),d=o.substr(0,i),a=function(){if("@"==e.icon.charAt(0)){var o=e.icon.substr(1),n=d+"/"+o;return Promise.resolve(r.existsSync(n)).then(function(e){return e?Promise.resolve(b.default(n)).then(function(e){return Promise.resolve(e.metadata()).then(function(o){64==o.width&&64==o.height||console.log("📸 "+m.default.red.bold("Tamanho da imagem do icone diferente de 64x64...")+" redimensionando...");var n=e.resize(64,64);return Promise.resolve(n.toBuffer()).then(function(e){var n=e.toString("base64");return console.log("📸 "+m.default.green.bold("Imagem do icone gerada: "+n.length+" bytes")+" ✔️"),t=1,"data:image/"+o.format+";base64,"+n})})}):(console.log("🙁 "+m.default.red.bold("imagem do icone ")+o+m.default.red.bold(" não encontrada")),t=1,!1)})}}();return Promise.resolve(a&&a.then?a.then(n):n(a))}catch(e){return Promise.reject(e)}}},N={prefix:"",user_dev:"",set_config:!1,config:void 0,setPrefix:function(e){N.prefix=e},missingField:function(e,o,t){return null!=e||(console.log("🙁 "+m.default.red.bold("informações não encontradas...")),console.log("🤔 "+m.default.blue("você adicionou o atributo ["+o+"] no "+t+" ?")),!1)},setConfig:function(e){N.set_config=!0,N.missingField(e.user_dev,"user_dev","config.json")&&N.missingField(e.user_dev.id,"user_dev.id","config.json")&&N.missingField(e.user_dev.name,"user_dev.name","config.json")&&(N.config=e,N.user_dev=e.user_dev)},splash:function(){console.log("🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱"),console.log("  🟥🔷 "+N.prefix+" widget"),console.log("  {}🟪 CREATOR (v 1.0)"),console.log("🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱"),console.log(m.default.yellow.bold("👨‍💻 Olá "+N.user_dev.name+"!"))},init:function(){if(!N.set_config)return console.log("🙁 "+m.default.red.bold("config não inicializado...")),void console.log("🤔 "+m.default.blue("você chamou setConfig() ?"));N.splash(),k.init(N.config),j.init(N.config)}},F={prefix:"",user_dev:"",set_config:!1,config:void 0,setPrefix:function(e){F.prefix=e},missingField:function(e,o,t){return null!=e||(console.log("🙁 "+m.default.red.bold("informações não encontradas...")),console.log("🤔 "+m.default.blue("você adicionou o atributo ["+o+"] no "+t+" ?")),!1)},setConfig:function(e){F.set_config=!0,F.missingField(e.user_dev,"user_dev","config.json")&&F.missingField(e.user_dev.id,"user_dev.id","config.json")&&F.missingField(e.user_dev.name,"user_dev.name","config.json")&&(F.config=e,F.user_dev=e.user_dev)},splash:function(){console.log("〰️〰️〰️〰️〰️〰️〰️〰️〰️〰️〰️"),console.log("  🟥🔷 "+F.prefix+" widget"),console.log("  {}🟪 CLONE (v 1.0)"),console.log("〰️〰️〰️〰️〰️〰️〰️〰️〰️〰️〰️"),console.log(m.default.yellow.bold("👨‍💻 Olá "+F.user_dev.name+"!"))},init:function(e,o){try{if(!F.set_config)return console.log("🙁 "+m.default.red.bold("config não inicializado...")),console.log("🤔 "+m.default.blue("você chamou setConfig() ?")),Promise.resolve();F.splash();var t=m.default.green.bold("[🏷️ NS:"+e+"] [🪪 ID:"+o+"]");return console.log("👀 procurando widget "+t),Promise.resolve(O("widgets/"+e+"/"+o)).then(function(e){var o=function(){if(null!=e){console.log("👍 "+m.default.green.bold("achei")),console.log("💫 "+m.default.blue("clonando em na pasta ")+F.config.widgets_folder);var o="<template>\n\t"+e.template+"\n</template>";return o=o+"\n<script>\nexport default "+e.script+"\n<\/script>",Promise.resolve(r.writeFileSync(F.config.widgets_folder+"/"+e.id+".vue",o)).then(function(){console.log("💫 "+m.default.blue("arquivo ")+e.id+".vue"+m.default.green.bold(" salvo com sucesso!"))})}console.log("🙁 "+m.default.red.bold("não encontrado..."))}();if(o&&o.then)return o.then(function(){})})}catch(e){return Promise.reject(e)}}};e.clone=F,e.creator=N});
//# sourceMappingURL=widget-creator.umd.js.map
