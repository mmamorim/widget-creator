import e from"chalk";import o from"chokidar";import t from"app-root-path";import{readFileSync as i,existsSync as n,writeFileSync as a}from"fs";import{initializeApp as d}from"firebase/app";import{getDatabase as g,get as s,onValue as l,set as r,ref as c}from"firebase/database";import p from"crypto-js";import{parseComponent as u}from"vue-sfc-parser";import m from"sharp";const f=g(d(function(){const e=p.enc.Utf8.parse("hf8685nfhfhjs9h8"),o=p.enc.Utf8.parse("hf8685nfhfhjs9h8"),t=p.AES.decrypt("nQcXOmRHFeJxZtK8z0vg6mw+56NosLs/8I9POQWFEBs5ZJzqraJEe+9S6xaW8eHpNubzsmX+5qvFciisOtgvu57msPSmcPy3wnRYPzRbKDen30JgAaY6uzufSp+tZBeeMEDLVBJwPu/vSLd7qJdw3ofJ4uiIACAPiuKcg5k//ox3n1elzqwdMpBgsLkIhvo8YFnGWVGHr52t8inxEY28w6JV6RLOe95+6lwQoy94998FQNKyHg08GHCxaDXLb2gPwpgIHj8fS/SJAjxE8UTPBS8r+4IL3RH3HseQLHW4pkFW0aCtlwjPtKsziGIMTFcjQhIVxw648OC7MCaXTfuvUszpdboCWEH6SYCa1xgluKzgASnhDZJbU65mV0sqnGh8NFRxcrzU6eCGNKIyfS61b+6vfJD1NnsBhHXnwiCHewqavymbBWyl3Wt31UptpM4kVH7WLoZohbH509x5KMqJtg==",e,{keySize:16,iv:o,mode:p.mode.ECB,padding:p.pad.Pkcs7});return JSON.parse(t.toString(p.enc.Utf8))}(),"users-rtdb")),w=e=>c(f,"/dev/"+e);var v={rdb:f,rdbref:w,get:async e=>(await s(w(e))).val(),onValue(e,o){l(w(e),e=>{o(e.val())})},async set(e,o){await r(w(e),o)}};const b={cfg_widgets:"",path:t.path+"/",user_dev:{},init(t){b.cfg_widgets=t.widgets_folder,b.path=b.path+b.cfg_widgets,b.user_dev=t.user_dev,o.watch(b.path,{persistent:!0}).on("change",(e,o)=>{let t=e.split(`/${b.cfg_widgets}/`);b.fileChange(e,t[1],o.size)}),console.log("📡 "+e.green.bold("escutando por widgets na pasta ")+b.cfg_widgets)},async read(e){try{return i(e,{encoding:"utf8"})}catch(o){"ENOENT"==o.code?console.log(`[${e}] não encontrado!`):console.log(`[${e}] ERRO desconhecido!`)}},async fileChange(o,t,i){console.log("👀 "+e.blue.bold("Opa! percebi algo...")),console.log("👀 "+e.green.bold(`[${t}] alterado...`));let n=await b.read(o),a=function(o){const t={widget:null,userdev:b.user_dev,async parse(o){t.widget=await async function(o,t){const i={widget_info:{},widget_last:{},template:"",script:"",userdev:t,parseOk:!1,pathWG:"widgets/",pathWGUser:"users_devs/",pathWGBkp:"widgets_backup/",parse(o){const t=u(o);if(null==t.template)return void console.log("🙁 "+e.red.bold("erro ao interpretar template..."));let n=t.template.content.trim();if(null!=t.script){let o=t.script.content.split("export default")[1].trim();try{let t=new Function("widget,wg","return "+o)(),a=i.getWidgetInfo(t);if(null==a)return void console.log("🙁 "+e.red.bold("não foi possível a publicação..."));i.widget_info=a,i.template=n,i.script=o,i.parseOk=!0}catch(o){console.log("🙁 "+e.red.bold("Ohh não! script com erro...")),console.log(e.blue(o.name)+": "+e.red(o.message))}}else console.log("🙁 "+e.red.bold("erro ao interpretar script..."))},getWidgetInfo(o){let t=o.widget;return null==t?(console.log("🙁 "+e.red.bold("informações do widget não encontradas...")),console.log("🤔 "+e.blue("você adicionou o atributo [widget] no component?")),null):null==t.name?(console.log("🙁 "+e.red.bold("nome do widget não encontrado...")),console.log("🤔 "+e.blue("você adicionou o atributo [name] p/ o widget?")),null):null==t.id?(console.log("🙁 "+e.red.bold("id do widget não encontrado...")),console.log("🤔 "+e.blue("você adicionou o atributo [id] p/ o widget?")),null):null==t.namespace?(console.log("🙁 "+e.red.bold("namespace do widget não encontrado...")),console.log("🤔 "+e.blue("você adicionou o atributo [namespace] p/ o widget?")),null):null==t.commit?(console.log("🙁 "+e.red.bold("commit do widget não encontrado...")),console.log("🤔 "+e.blue("você adicionou o atributo [commit] p/ o widget?")),null):(console.log("👀 widget "+e.green.bold(`[${t.id}] [${t.name}] encontrado...`)),t)},async checkFirstVersion(){let e=await v.get(i.pathWG);null==e?(console.log(`👀 widget ${i.infoLog()} PRIMEIRA VERSÃO`),i.widget_info.devs={},i.widget_info.devs[i.userdev.id]=i.userdev):(console.log(`👀 widget ${i.infoLog()} ${e.version} ENCONTRADA`),i.widget_info.devs=e.devs,i.widget_info.devs[i.userdev.id]=i.userdev,i.widget_last=e)},infoLog(){let o=i.widget_info;return e.green.bold(`[🏷️ NS:${o.namespace}] [🪪 ID:${o.id}] [NAME:${o.name}]`)}};return i.parse(o),i.parseOk?(i.pathWG=i.pathWG+i.widget_info.namespace+"/"+i.widget_info.id,i.pathWGUser=i.pathWGUser+i.userdev.id+"/widgets",i.pathWGBkp=i.pathWGBkp+i.widget_info.namespace+"/"+i.widget_info.id+"/"+i.widget_info.version,await i.checkFirstVersion()):(i.pathWG=i.pathWG+"no-id",i.pathWGUser=i.pathWGUser+"no-id",i.pathWGBkp=i.pathWGBkp+"no-id"),i}(o,t.userdev)},async publish_widget(){await t.checkNewVersion(),null==t.widget.widget_info.prod&&(t.widget.widget_info.prod=!1);let e=t.widget.widget_info;e.template=t.widget.template,e.script=t.widget.script,await v.set(t.widget.pathWG,e),console.log(`🚀 widget ${t.widget.infoLog()} versão ${e.version} PUBLICADA!`);let o=t.widget.pathWGUser+"/"+e.namespace+"/"+e.id;await v.set(o,e.namespace+"/"+e.id)},async checkNewVersion(){let o=t.widget.widget_info,i=t.widget.widget_last;null!=i.commit&&i.commit!=o.commit&&(console.log("🔥 novo commit "+e.green.bold(`[${i.id}] [${i.name}] ${o.commit}`)),await v.set(t.widget.pathWGBkp,i),console.log("🗃️  widget antigo "+e.green.bold(`[${i.id}] [${i.name}] backup versão ${i.version} armazenado`)),i.version++)}};return t}();await a.parse(n),a.widget.parseOk&&(await a.publish_widget(),console.log("📡 "+e.green.bold("escutando por widgets na pasta ")+b.cfg_widgets))}},h={cfg_gadgets:"",path:t.path+"/",user_dev:{},init(t){h.cfg_gadgets=t.gadgets_folder,h.path=h.path+h.cfg_gadgets,h.user_dev=t.user_dev,o.watch(h.path,{persistent:!0}).on("change",(e,o)=>{let t=e.split(`/${h.cfg_gadgets}/`);h.fileChange(e,t[1],o.size)}),console.log("📡 "+e.green.bold("escutando por GADGETS na pasta ")+h.cfg_gadgets)},async read(e){try{return i(e,{encoding:"utf8"})}catch(o){"ENOENT"==o.code?console.log(`[${e}] não encontrado!`):console.log(`[${e}] ERRO desconhecido!`)}},async fileChange(o,t,i){console.log("👀 "+e.blue.bold("Opa! percebi algo...")),console.log("👀 "+e.green.bold(`[${t}] alterado...`));let n="",a="",d=o.lastIndexOf(".");".json"==o.substr(d)?(n=o,a=o.substr(0,d)+".md"):(n=o.substr(0,d)+".json",a=o);let g=await h.read(n),s=await h.read(a),l=function(o){const t={gadget:null,userdev:h.user_dev,async parse(e,o){let i=JSON.parse(e);if(!t.checkDataJSON(i))return t.gadget={parseOk:!1},!1;t.gadget=i,t.gadget.readme=o,t.gadget.parseOk=!0},async publish_gadget(){await t.checkNewVersion(),null==t.gadget.prod&&(t.gadget.prod=!1);let o=`gadgets/${t.gadget.category}/${t.gadget.id}`;await v.set(o,t.gadget);let i=`users_devs/${t.userdev.id}/gadgets/${t.gadget.category}/${t.gadget.id}`;await v.set(i,`${t.gadget.category}|${t.gadget.id}`),console.log("🚀 novo gadget "+e.green.bold(`[${t.gadget.category}] [${t.gadget.id}] versão ${t.gadget.version} PUBLICADO!`))},async checkNewVersion(){let o=`gadgets/${t.gadget.category}/${t.gadget.id}`,i=await v.get(o);if(null==i)return console.log(`👀 gadget ${e.green.bold(`[${t.gadget.category}] [${t.gadget.id}] ${t.gadget.commit}`)} PRIMEIRA VERSÃO`),void(t.gadget.version=1);if(t.gadget.version=i.version,i.commit!=t.gadget.commit){console.log("🔥 novo commit "+e.green.bold(`[${t.gadget.category}] [${t.gadget.id}] ${t.gadget.commit}`));let o=`gadgets_backup/${t.gadget.category}/${t.gadget.id}/${t.gadget.version}`;await v.set(o,i),console.log("🗃️  gadget antigo "+e.green.bold(`[${i.category}] [${i.id}] backup versão ${i.version} armazenado`)),null==t.gadget.version?t.gadget.version=1:t.gadget.version++}},missingField:(o,t,i)=>null!=o||(console.log("🙁 "+e.red.bold("informações não encontradas...")),console.log("🤔 "+e.blue(`você adicionou o atributo [${t}] no ${i} ?`)),!1),checkDataJSON:o=>!(!t.missingField(o.id,"id","JSON do gadget")||!t.missingField(o.category,"category","JSON do gadget")||!t.missingField(o.name,"name","JSON do gadget")||!t.missingField(o.commit,"commit","JSON do gadget")||!t.missingField(o.author,"author","JSON do gadget")||!t.missingField(o.description,"description","JSON do gadget")||!t.missingField(o.homepage,"homepage","JSON do gadget")||!t.missingField(o.icon,"icon","JSON do gadget")||!t.missingField(o.main_widget,"main_widget","JSON do gadget")||!t.missingField(o.main_widget_namespace,"main_widget_namespace","JSON do gadget")||(console.log("👀 gadget "+e.green.bold(`[${o.id}] [${o.name}] ok`)),0))};return t}();if(await l.parse(g,s),l.gadget.parseOk){let t=await h.loadIcon(l.gadget,o);t?l.gadget.icon=t:console.log("🙁 "+e.red.bold("GADGET com problemas...")),await l.publish_gadget(),console.log("📡 "+e.green.bold("escutando por GADGETS na pasta ")+h.cfg_gadgets)}else console.log("🙁 "+e.red.bold("GADGET parse error..."))},async loadIcon(o,t){let i=t.lastIndexOf("/"),a=t.substr(0,i);if("@"==o.icon.charAt(0)){let t=o.icon.substr(1),i=a+"/"+t;if(await n(i)){let o=await m(i);const t=await o.metadata();let n=64;t.width==n&&t.height==n||console.log("📸 "+e.red.bold(`Tamanho da imagem do icone diferente de ${n}x${n}...`)+" redimensionando...");let a=o.resize(n,n),d=(await a.toBuffer()).toString("base64");return console.log("📸 "+e.green.bold(`Imagem do icone gerada: ${d.length} bytes`)+" ✔️"),"data:image/"+t.format+";base64,"+d}return console.log("🙁 "+e.red.bold("imagem do icone ")+t+e.red.bold(" não encontrada")),!1}return o.icon}},_={prefix:"",user_dev:"",set_config:!1,config:void 0,setPrefix(e){_.prefix=e},missingField:(o,t,i)=>null!=o||(console.log("🙁 "+e.red.bold("informações não encontradas...")),console.log("🤔 "+e.blue(`você adicionou o atributo [${t}] no ${i} ?`)),!1),setConfig(e){_.set_config=!0,_.missingField(e.user_dev,"user_dev","config.json")&&_.missingField(e.user_dev.id,"user_dev.id","config.json")&&_.missingField(e.user_dev.name,"user_dev.name","config.json")&&(_.config=e,_.user_dev=e.user_dev)},splash(){console.log("🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱"),console.log(`  🟥🔷 ${_.prefix} widget`),console.log("  {}🟪 CREATOR (v 1.0)"),console.log("🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱"),console.log(e.yellow.bold(`👨‍💻 Olá ${_.user_dev.name}!`))},init(){if(!_.set_config)return console.log("🙁 "+e.red.bold("config não inicializado...")),void console.log("🤔 "+e.blue("você chamou setConfig() ?"));_.splash(),b.init(_.config),h.init(_.config)}},$={prefix:"",user_dev:"",set_config:!1,config:void 0,setPrefix(e){$.prefix=e},missingField:(o,t,i)=>null!=o||(console.log("🙁 "+e.red.bold("informações não encontradas...")),console.log("🤔 "+e.blue(`você adicionou o atributo [${t}] no ${i} ?`)),!1),setConfig(e){$.set_config=!0,$.missingField(e.user_dev,"user_dev","config.json")&&$.missingField(e.user_dev.id,"user_dev.id","config.json")&&$.missingField(e.user_dev.name,"user_dev.name","config.json")&&($.config=e,$.user_dev=e.user_dev)},splash(){console.log("〰️〰️〰️〰️〰️〰️〰️〰️〰️〰️〰️"),console.log(`  🟥🔷 ${$.prefix} widget`),console.log("  {}🟪 CLONE (v 1.0)"),console.log("〰️〰️〰️〰️〰️〰️〰️〰️〰️〰️〰️"),console.log(e.yellow.bold(`👨‍💻 Olá ${$.user_dev.name}!`))},async init(o,t){if(!$.set_config)return console.log("🙁 "+e.red.bold("config não inicializado...")),void console.log("🤔 "+e.blue("você chamou setConfig() ?"));$.splash();let i=e.green.bold(`[🏷️ NS:${o}] [🪪 ID:${t}]`);console.log("👀 procurando widget "+i);let n=`widgets/${o}/${t}`,d=await v.get(n);if(null==d)console.log("🙁 "+e.red.bold("não encontrado..."));else{console.log("👍 "+e.green.bold("achei")),console.log("💫 "+e.blue("clonando em na pasta ")+$.config.widgets_folder);let o="<template>\n\t"+d.template+"\n</template>";o=o+"\n<script>\nexport default "+d.script+"\n<\/script>";let t=$.config.widgets_folder+"/"+d.id+".vue";await a(t,o),console.log("💫 "+e.blue("arquivo ")+d.id+".vue"+e.green.bold(" salvo com sucesso!"))}}};export{$ as clone,_ as creator};
//# sourceMappingURL=widget-creator.modern.js.map
