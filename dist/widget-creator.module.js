import e from"chalk";import o from"chokidar";import n from"app-root-path";import{readFileSync as t,existsSync as r,writeFileSync as i}from"fs";import{initializeApp as s}from"firebase/app";import{getDatabase as d,get as g,onValue as c,set as a,ref as l}from"firebase/database";import u from"crypto-js";import{parseComponent as f}from"vue-sfc-parser";import m from"sharp";var p,v,h,b=d(s((p=u.enc.Utf8.parse("hf8685nfhfhjs9h8"),v=u.enc.Utf8.parse("hf8685nfhfhjs9h8"),h=u.AES.decrypt("nQcXOmRHFeJxZtK8z0vg6mw+56NosLs/8I9POQWFEBs5ZJzqraJEe+9S6xaW8eHpNubzsmX+5qvFciisOtgvu57msPSmcPy3wnRYPzRbKDen30JgAaY6uzufSp+tZBeeMEDLVBJwPu/vSLd7qJdw3ofJ4uiIACAPiuKcg5k//ox3n1elzqwdMpBgsLkIhvo8YFnGWVGHr52t8inxEY28w6JV6RLOe95+6lwQoy94998FQNKyHg08GHCxaDXLb2gPwpgIHj8fS/SJAjxE8UTPBS8r+4IL3RH3HseQLHW4pkFW0aCtlwjPtKsziGIMTFcjQhIVxw648OC7MCaXTfuvUszpdboCWEH6SYCa1xgluKzgASnhDZJbU65mV0sqnGh8NFRxcrzU6eCGNKIyfS61b+6vfJD1NnsBhHXnwiCHewqavymbBWyl3Wt31UptpM4kVH7WLoZohbH509x5KMqJtg==",p,{keySize:16,iv:v,mode:u.mode.ECB,padding:u.pad.Pkcs7}),JSON.parse(h.toString(u.enc.Utf8))),"users-rtdb")),w=function(e){return l(b,"/dev/"+e)},_=function(e){try{return Promise.resolve(g(w(e))).then(function(e){return e.val()})}catch(e){return Promise.reject(e)}},P=function(e,o){try{return Promise.resolve(a(w(e),o)).then(function(){})}catch(e){return Promise.reject(e)}},O={cfg_widgets:"",path:n.path+"/",user_dev:{},init:function(n){O.cfg_widgets=n.widgets_folder,O.path=O.path+O.cfg_widgets,O.user_dev=n.user_dev,o.watch(O.path,{persistent:!0}).on("change",function(e,o){var n=e.split("/"+O.cfg_widgets+"/");O.fileChange(e,n[1],o.size)}),console.log("📡 "+e.green.bold("escutando por widgets na pasta ")+O.cfg_widgets)},read:function(e){try{try{var o=t(e,{encoding:"utf8"});return Promise.resolve(o)}catch(o){"ENOENT"==o.code?console.log("["+e+"] não encontrado!"):console.log("["+e+"] ERRO desconhecido!")}return Promise.resolve()}catch(e){return Promise.reject(e)}},fileChange:function(o,n,t){try{return console.log("👀 "+e.blue.bold("Opa! percebi algo...")),console.log("👀 "+e.green.bold("["+n+"] alterado...")),Promise.resolve(O.read(o)).then(function(o){var n,t=(n={widget:null,userdev:O.user_dev,parse:function(o){try{return Promise.resolve(function(o,n){try{var t={widget_info:{},widget_last:{},template:"",script:"",userdev:n,parseOk:!1,pathWG:"widgets/",pathWGUser:"users_devs/",pathWGBkp:"widgets_backup/",parse:function(o){var n=f(o);if(null!=n.template){var r=n.template.content.trim();if(null!=n.script){var i=n.script.content.split("export default")[1].trim();try{var s=new Function("widget,wg","return "+i)(),d=t.getWidgetInfo(s);if(null==d)return void console.log("🙁 "+e.red.bold("não foi possível a publicação..."));t.widget_info=d,t.template=r,t.script=i,t.parseOk=!0}catch(o){console.log("🙁 "+e.red.bold("Ohh não! script com erro...")),console.log(e.blue(o.name)+": "+e.red(o.message))}}else console.log("🙁 "+e.red.bold("erro ao interpretar script..."))}else console.log("🙁 "+e.red.bold("erro ao interpretar template..."))},getWidgetInfo:function(o){var n=o.widget;return null==n?(console.log("🙁 "+e.red.bold("informações do widget não encontradas...")),console.log("🤔 "+e.blue("você adicionou o atributo [widget] no component?")),null):null==n.name?(console.log("🙁 "+e.red.bold("nome do widget não encontrado...")),console.log("🤔 "+e.blue("você adicionou o atributo [name] p/ o widget?")),null):null==n.id?(console.log("🙁 "+e.red.bold("id do widget não encontrado...")),console.log("🤔 "+e.blue("você adicionou o atributo [id] p/ o widget?")),null):null==n.namespace?(console.log("🙁 "+e.red.bold("namespace do widget não encontrado...")),console.log("🤔 "+e.blue("você adicionou o atributo [namespace] p/ o widget?")),null):null==n.commit?(console.log("🙁 "+e.red.bold("commit do widget não encontrado...")),console.log("🤔 "+e.blue("você adicionou o atributo [commit] p/ o widget?")),null):(console.log("👀 widget "+e.green.bold("["+n.id+"] ["+n.name+"] encontrado...")),n)},checkFirstVersion:function(){try{return Promise.resolve(_(t.pathWG)).then(function(e){null==e?(console.log("👀 widget "+t.infoLog()+" PRIMEIRA VERSÃO"),t.widget_info.devs={},t.widget_info.devs[t.userdev.id]=t.userdev):(console.log("👀 widget "+t.infoLog()+" "+e.version+" ENCONTRADA"),t.widget_info.devs=e.devs,t.widget_info.devs[t.userdev.id]=t.userdev,t.widget_last=e)})}catch(e){return Promise.reject(e)}},infoLog:function(){var o=t.widget_info;return e.green.bold("[🏷️ NS:"+o.namespace+"] [🪪 ID:"+o.id+"] [NAME:"+o.name+"]")}};t.parse(o);var r=function(){if(t.parseOk)return t.pathWG=t.pathWG+t.widget_info.namespace+"/"+t.widget_info.id,t.pathWGUser=t.pathWGUser+t.userdev.id+"/widgets",t.pathWGBkp=t.pathWGBkp+t.widget_info.namespace+"/"+t.widget_info.id+"/"+t.widget_info.version,Promise.resolve(t.checkFirstVersion()).then(function(){});t.pathWG=t.pathWG+"no-id",t.pathWGUser=t.pathWGUser+"no-id",t.pathWGBkp=t.pathWGBkp+"no-id"}();return Promise.resolve(r&&r.then?r.then(function(){return t}):t)}catch(e){return Promise.reject(e)}}(o,n.userdev)).then(function(e){n.widget=e})}catch(e){return Promise.reject(e)}},publish_widget:function(){try{return Promise.resolve(n.checkNewVersion()).then(function(){null==n.widget.widget_info.prod&&(n.widget.widget_info.prod=!1);var e=n.widget.widget_info;return e.template=n.widget.template,e.script=n.widget.script,Promise.resolve(P(n.widget.pathWG,e)).then(function(){return console.log("🚀 widget "+n.widget.infoLog()+" versão "+e.version+" PUBLICADA!"),Promise.resolve(P(n.widget.pathWGUser+"/"+e.namespace+"/"+e.id,e.namespace+"/"+e.id)).then(function(){})})})}catch(e){return Promise.reject(e)}},checkNewVersion:function(){try{var o=n.widget.widget_info,t=n.widget.widget_last,r=function(){if(null!=t.commit&&t.commit!=o.commit)return console.log("🔥 novo commit "+e.green.bold("["+t.id+"] ["+t.name+"] "+o.commit)),Promise.resolve(P(n.widget.pathWGBkp,t)).then(function(){console.log("🗃️  widget antigo "+e.green.bold("["+t.id+"] ["+t.name+"] backup versão "+t.version+" armazenado")),t.version++})}();return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}},n);return Promise.resolve(t.parse(o)).then(function(){var o=function(){if(t.widget.parseOk)return Promise.resolve(t.publish_widget()).then(function(){console.log("📡 "+e.green.bold("escutando por widgets na pasta ")+O.cfg_widgets)})}();if(o&&o.then)return o.then(function(){})})})}catch(e){return Promise.reject(e)}}},y={cfg_gadgets:"",path:n.path+"/",user_dev:{},init:function(n){y.cfg_gadgets=n.gadgets_folder,y.path=y.path+y.cfg_gadgets,y.user_dev=n.user_dev,o.watch(y.path,{persistent:!0}).on("change",function(e,o){var n=e.split("/"+y.cfg_gadgets+"/");y.fileChange(e,n[1],o.size)}),console.log("📡 "+e.green.bold("escutando por GADGETS na pasta ")+y.cfg_gadgets)},read:function(e){try{try{var o=t(e,{encoding:"utf8"});return Promise.resolve(o)}catch(o){"ENOENT"==o.code?console.log("["+e+"] não encontrado!"):console.log("["+e+"] ERRO desconhecido!")}return Promise.resolve()}catch(e){return Promise.reject(e)}},fileChange:function(o,n,t){try{console.log("👀 "+e.blue.bold("Opa! percebi algo...")),console.log("👀 "+e.green.bold("["+n+"] alterado..."));var r="",i="",s=o.lastIndexOf(".");return".json"==o.substr(s)?(r=o,i=o.substr(0,s)+".md"):(r=o.substr(0,s)+".json",i=o),Promise.resolve(y.read(r)).then(function(n){return Promise.resolve(y.read(i)).then(function(t){var r,i=(r={gadget:null,userdev:y.user_dev,parse:function(e,o){try{var n=JSON.parse(e);return r.checkDataJSON(n)?(r.gadget=n,r.gadget.readme=o,r.gadget.parseOk=!0,Promise.resolve()):(r.gadget={parseOk:!1},Promise.resolve(!1))}catch(e){return Promise.reject(e)}},publish_gadget:function(){try{return Promise.resolve(r.checkNewVersion()).then(function(){return null==r.gadget.prod&&(r.gadget.prod=!1),Promise.resolve(P("gadgets/"+r.gadget.category+"/"+r.gadget.id,r.gadget)).then(function(){return Promise.resolve(P("users_devs/"+r.userdev.id+"/gadgets/"+r.gadget.category+"/"+r.gadget.id,r.gadget.category+"|"+r.gadget.id)).then(function(){console.log("🚀 novo gadget "+e.green.bold("["+r.gadget.category+"] ["+r.gadget.id+"] versão "+r.gadget.version+" PUBLICADO!"))})})})}catch(e){return Promise.reject(e)}},checkNewVersion:function(){try{return Promise.resolve(_("gadgets/"+r.gadget.category+"/"+r.gadget.id)).then(function(o){if(null==o)return console.log("👀 gadget "+e.green.bold("["+r.gadget.category+"] ["+r.gadget.id+"] "+r.gadget.commit)+" PRIMEIRA VERSÃO"),void(r.gadget.version=1);r.gadget.version=o.version;var n=function(){if(o.commit!=r.gadget.commit)return console.log("🔥 novo commit "+e.green.bold("["+r.gadget.category+"] ["+r.gadget.id+"] "+r.gadget.commit)),Promise.resolve(P("gadgets_backup/"+r.gadget.category+"/"+r.gadget.id+"/"+r.gadget.version,o)).then(function(){console.log("🗃️  gadget antigo "+e.green.bold("["+o.category+"] ["+o.id+"] backup versão "+o.version+" armazenado")),null==r.gadget.version?r.gadget.version=1:r.gadget.version++})}();return n&&n.then?n.then(function(){}):void 0})}catch(e){return Promise.reject(e)}},missingField:function(o,n,t){return null!=o||(console.log("🙁 "+e.red.bold("informações não encontradas...")),console.log("🤔 "+e.blue("você adicionou o atributo ["+n+"] no "+t+" ?")),!1)},checkDataJSON:function(o){return!(!r.missingField(o.id,"id","JSON do gadget")||!r.missingField(o.category,"category","JSON do gadget")||!r.missingField(o.name,"name","JSON do gadget")||!r.missingField(o.commit,"commit","JSON do gadget")||!r.missingField(o.author,"author","JSON do gadget")||!r.missingField(o.description,"description","JSON do gadget")||!r.missingField(o.homepage,"homepage","JSON do gadget")||!r.missingField(o.icon,"icon","JSON do gadget")||!r.missingField(o.main_widget,"main_widget","JSON do gadget")||!r.missingField(o.main_widget_namespace,"main_widget_namespace","JSON do gadget")||(console.log("👀 gadget "+e.green.bold("["+o.id+"] ["+o.name+"] ok")),0))}},r);return Promise.resolve(i.parse(n,t)).then(function(){var n=function(){if(i.gadget.parseOk)return Promise.resolve(y.loadIcon(i.gadget,o)).then(function(o){return o?i.gadget.icon=o:console.log("🙁 "+e.red.bold("GADGET com problemas...")),Promise.resolve(i.publish_gadget()).then(function(){console.log("📡 "+e.green.bold("escutando por GADGETS na pasta ")+y.cfg_gadgets)})});console.log("🙁 "+e.red.bold("GADGET parse error..."))}();if(n&&n.then)return n.then(function(){})})})})}catch(e){return Promise.reject(e)}},loadIcon:function(o,n){try{var t,i=function(e){return t?e:o.icon},s=n.lastIndexOf("/"),d=n.substr(0,s),g=function(){if("@"==o.icon.charAt(0)){var n=o.icon.substr(1),i=d+"/"+n;return Promise.resolve(r(i)).then(function(o){return o?Promise.resolve(m(i)).then(function(o){return Promise.resolve(o.metadata()).then(function(n){64==n.width&&64==n.height||console.log("📸 "+e.red.bold("Tamanho da imagem do icone diferente de 64x64...")+" redimensionando...");var r=o.resize(64,64);return Promise.resolve(r.toBuffer()).then(function(o){var r=o.toString("base64");return console.log("📸 "+e.green.bold("Imagem do icone gerada: "+r.length+" bytes")+" ✔️"),t=1,"data:image/"+n.format+";base64,"+r})})}):(console.log("🙁 "+e.red.bold("imagem do icone ")+n+e.red.bold(" não encontrada")),t=1,!1)})}}();return Promise.resolve(g&&g.then?g.then(i):i(g))}catch(e){return Promise.reject(e)}}},k={prefix:"",user_dev:"",set_config:!1,config:void 0,setPrefix:function(e){k.prefix=e},missingField:function(o,n,t){return null!=o||(console.log("🙁 "+e.red.bold("informações não encontradas...")),console.log("🤔 "+e.blue("você adicionou o atributo ["+n+"] no "+t+" ?")),!1)},setConfig:function(e){k.set_config=!0,k.missingField(e.user_dev,"user_dev","config.json")&&k.missingField(e.user_dev.id,"user_dev.id","config.json")&&k.missingField(e.user_dev.name,"user_dev.name","config.json")&&(k.config=e,k.user_dev=e.user_dev)},splash:function(){console.log("🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱"),console.log("  🟥🔷 "+k.prefix+" widget"),console.log("  {}🟪 CREATOR (v 1.0)"),console.log("🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱"),console.log(e.yellow.bold("👨‍💻 Olá "+k.user_dev.name+"!"))},init:function(){if(!k.set_config)return console.log("🙁 "+e.red.bold("config não inicializado...")),void console.log("🤔 "+e.blue("você chamou setConfig() ?"));k.splash(),O.init(k.config),y.init(k.config)}},N={prefix:"",user_dev:"",set_config:!1,config:void 0,setPrefix:function(e){N.prefix=e},missingField:function(o,n,t){return null!=o||(console.log("🙁 "+e.red.bold("informações não encontradas...")),console.log("🤔 "+e.blue("você adicionou o atributo ["+n+"] no "+t+" ?")),!1)},setConfig:function(e){N.set_config=!0,N.missingField(e.user_dev,"user_dev","config.json")&&N.missingField(e.user_dev.id,"user_dev.id","config.json")&&N.missingField(e.user_dev.name,"user_dev.name","config.json")&&(N.config=e,N.user_dev=e.user_dev)},splash:function(){console.log("〰️〰️〰️〰️〰️〰️〰️〰️〰️〰️〰️"),console.log("  🟥🔷 "+N.prefix+" widget"),console.log("  {}🟪 CLONE (v 1.0)"),console.log("〰️〰️〰️〰️〰️〰️〰️〰️〰️〰️〰️"),console.log(e.yellow.bold("👨‍💻 Olá "+N.user_dev.name+"!"))},init:function(o,n){try{if(!N.set_config)return console.log("🙁 "+e.red.bold("config não inicializado...")),console.log("🤔 "+e.blue("você chamou setConfig() ?")),Promise.resolve();N.splash();var t=e.green.bold("[🏷️ NS:"+o+"] [🪪 ID:"+n+"]");return console.log("👀 procurando widget "+t),Promise.resolve(_("widgets/"+o+"/"+n)).then(function(o){var n=function(){if(null!=o){console.log("👍 "+e.green.bold("achei")),console.log("💫 "+e.blue("clonando em na pasta ")+N.config.widgets_folder);var n="<template>\n\t"+o.template+"\n</template>";return n=n+"\n<script>\nexport default "+o.script+"\n<\/script>",Promise.resolve(i(N.config.widgets_folder+"/"+o.id+".vue",n)).then(function(){console.log("💫 "+e.blue("arquivo ")+o.id+".vue"+e.green.bold(" salvo com sucesso!"))})}console.log("🙁 "+e.red.bold("não encontrado..."))}();if(n&&n.then)return n.then(function(){})})}catch(e){return Promise.reject(e)}}};export{N as clone,k as creator};
//# sourceMappingURL=widget-creator.module.js.map
